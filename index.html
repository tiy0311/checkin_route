<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PHOTOCATION</title>

    <!-- BLOCK: Loading libraries -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
    <script src="//www.parsecdn.com/js/parse-1.3.0.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <!--script src="//code.jquery.com/jquery-1.10.2.js"></script-->
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script type="text/javascript" src="date.js"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>

    <script src="sorttable.js"></script>

    <!-- google font links -->
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Gloria+Hallelujah' rel='stylesheet' type='text/css'> <!--Check-in Route-->
    <link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>      <!--button-->
    <link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'> <!--hand-writing font-->
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>   <!--table-->
    <link href='http://fonts.googleapis.com/css?family=Vollkorn:700' rel='stylesheet' type='text/css'>  <!--Map's Place Name-->
    <link href='http://fonts.googleapis.com/css?family=Russo+One' rel='stylesheet' type='text/css'>     <!--Map's Titles, like Data,From,Tags-->
    <!--link rel="stylesheet/less" type="text/css" href="carousel.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.1.0/less.min.js"></script-->
    <link rel="stylesheet" type="text/css" href="MyStyle.css">

    <!-- ENDBLOCK: Loading libraries -->

    <script>
    $(function() {
        $( "#from" ).datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            changeYear: true,
            onClose: function( selectedDate ) {
                $( "#to" ).datepicker( "option", "minDate", selectedDate );
            }
        });
        $( "#to" ).datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            changeYear: true,
            onClose: function( selectedDate ) {
                $( "#from" ).datepicker( "option", "maxDate", selectedDate );
            }
        });
    });
    </script>


</head>
<body>
    <!-- BLOCK: FB SDK initialization -->
    <div id="fb-root"></div>
    <!-- ENDBLOCK: FB SDK initialization -->

    <!-- BLOCK: Your playground -->

    <!-- Button for login to Facebook -->
    <div id="my-html-playground" class="container">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                
                <div id="brand">
                    <a class="navbar-brand" href="#" style="font-size:26px">
                        <span class="glyphicon glyphicon-map-marker"></span>
                        Photocation.
                    </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div id="my-logout-control" style="display:none">
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">


                        <ul class="nav navbar-nav navbar-right">

                            <li id="user-info"><a href="#">
                                <span class="glyphicon glyphicon-user"></span>
                                    &nbsp;&nbsp;<span id="user-name"></span>&nbsp;&nbsp;
                                    <span class="sr-only">(current)</span>
                            </a></li>


                            <li><a href="#" id="maps"><span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp;Photocation&nbsp;</a></li>


                            <form class="navbar-form navbar-left" role="search">
                                <span class="glyphicon glyphicon-search"></span>&nbsp;&nbsp;Search:&nbsp;
                               
                                <div class="form-group">
                                    <input type="text" class="form-control" id="search_text">
                                </div>

                                <!--button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search"></span>&nbsp;&nbsp;Search!&nbsp;</button-->
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Please select <span class="caret"></span></button>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                    <li><a href="#" onclick="searchAll()">All</a></li>
                                    <li><a href="#" onclick="searchFrom()">From</a></li>
                                    <li><a href="#" onclick="searchTags()">Tags</a></li>
                                    <li><a href="#" onclick="searchPlace()">Place Name</a></li>
                                    <li><a href="#" onclick="searchMessage()">Messages</a></li>
                                </ul>

                            </form>


                            <li><a href="#" id="my-logout-button">
                                <span class="glyphicon glyphicon-log-out"></span>
                                &nbsp;&nbsp;Logout&nbsp;
                            </a></li>

                        </ul>

                    </div><!-- /.navbar-collapse -->
                </div>


                <div id="my-login-control" style="display:bolck; float:right">
                    <button id="my-login-button" type="button" class="btn btn-default navbar-btn" style="margin-right:20px">
                        <span class="glyphicon glyphicon-log-in"></span>
                        &nbsp;Login with Facebook&nbsp;
                    </button>
                    <p class="navbar-text" id="my-logout-message" style="font-size:17px">&nbsp;&nbsp;</p>
                </div>

            </div><!-- /.container-fluid -->
        </nav>


        <!--nav class="navbar navbar-default" role="navigation">
            <div id="brand" style="margin-left:10px">
                <a class="navbar-brand" href="#" style="font-size:26px">
                    <span class="glyphicon glyphicon-map-marker"></span>
                    Photocation.
                </a>
            </div>
            <div id="my-login-control" style="display:bolck; float:right">
                <button id="my-login-button" type="button" class="btn btn-default navbar-btn" style="margin-right:20px">
                    <span class="glyphicon glyphicon-hand-right"></span>
                    &nbsp;Login with Facebook&nbsp;
                </button>
                <p class="navbar-text" id="my-logout-message" style="font-size:17px">&nbsp;&nbsp;</p>
            </div-->
            <!--div id="my-logout-control" style="display:none; float:right">
                <button id="my-logout-button" type="button" class="btn btn-default navbar-btn" style="margin-right:20px">
                    <span class="glyphicon glyphicon-off"></span>
                    &nbsp;Logout&nbsp;
                </button>
                <p class="navbar-text" id="my-login-message" style="font-size:17px">&nbsp;&nbsp;</p>
            </div-->

            <!--div id="my-logout-control" style="display:none">
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="display:none">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="font-size:16px;"><span class="glyphicon glyphicon-cog"></span>&nbsp;<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#" id="user-info">
                                    <span class="glyphicon glyphicon-user"></span>
                                    &nbsp;&nbsp;Hello <span id="user-name"></span>&nbsp;&nbsp;<i class="fa fa-smile-o"></i>
                                </a></li>
                                <li><a href="#" id="from-locations-button">
                                    <i class="fa fa-refresh"></i>
                                    &nbsp;&nbsp;Refetch Data&nbsp;
                                </a></li>
                                <li><a href="#" id="demonstrate-as-table-button">
                                    <span class="glyphicon glyphicon-search"></span>
                                    &nbsp;&nbsp;Table Demonstration&nbsp;
                                </a></li>
                                <li><a href="#" id="maps">
                                    <span class="glyphicon glyphicon-globe"></span>
                                    &nbsp;&nbsp;Photocation&nbsp;
                                </a></li>

                                <li class="divider"></li>

                                <li><a href="#" id="my-logout-button">
                                    <span class="glyphicon glyphicon-off"></span>
                                    &nbsp;&nbsp;Logout&nbsp;
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

        </nav-->

        <div class="alert alert-info" role="alert" id="warning-div" style="display:none">
            <h4 style="margin:0.8em 0 0.5em 3.5em">
                Remember to tag yourself in photos on the facebook &nbsp;<i class="fa fa-smile-o"></i><br />
                After tagging, please click <button class="btn btn-default" onClick="fbget_photos(userid, ACCESS_TOKEN);">here</button> to refetch your data and wait for a few seconds.
            </h4>
        </div>

        <!-- Profile Area -->
        <div id="my-profile" class="row" style="display:none;margin: 3em 0 20px 40px">

            <div class="col-md-3">
                <!-- Profile Picture -->
                <img id="my-profile-picture" class="img-thumbnail" src="" alt="">
            </div>

            <div class="col-md-9" style="font-size:16px">
                <!-- Profile Information -->
                <dl class="dl-horizontal">
                    <dt><b>Name</b></dt>
                    <dd id="my-profile-name"></dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><b>Username</b></dt>
                    <dd id="my-profile-username"></dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><b>Gender</b></dt>
                    <dd id="my-profile-gender"></dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><b>Birthday</b></dt>
                    <dd id="my-profile-birthday"></dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><b>Facebook ID</b></dt>
                    <dd id="my-profile-facebook-id"></dd>
                </dl>
            </div>
        </div>

        <div id="loading-div" style="display:none; margin-top:2em; margin-left:400px">
            <h4>Fetching data...<br />
                Please wait for a few seconds &nbsp;<i class="fa fa-smile-o"></i></h4>
            <!--img src ="http://medtube.pl/assets/FE/images/ajax-loader2.gif" /-->
        </div>


        <div id="photo-wall" style="display:none; margin-left:-3em">
            <ul id="holder">
            </ul>
        </div>


        <!--table-->
        <div id="location-div" style="display:none">
            
            <!--div class="row" style="margin:2em">
                <div class="col-lg-6">
                    <div class="input-group">
                        <input type="text" class="form-control" id="search_text">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Please select <span class="caret"></span></button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                <li><a href="#" onclick="searchAll()">All</a></li>
                                <li><a href="#" onclick="searchFrom()">From</a></li>
                                <li><a href="#" onclick="searchTags()">Tags</a></li>
                                <li><a href="#" onclick="searchPlace()">Place Name</a></li>
                                <li><a href="#" onclick="searchMessage()">Messages</a></li>
                            </ul>
                        </div><!-- /btn-group ->
                    </div><!-- /input-group ->
                </div><!-- /.col-lg-6 ->
            </div><!-- /.row -->


            <h4 id="no_results" style="display:none; margin:5em">Sorry, find no results!</h4>

            <table class="table table-hover table-bordered sortable" id="table">
                
                <thead id="thead">
                    <tr class="active"><b>
                        <th width="3%" style="text-align:center">#</th>
                        <th width="11%" style="text-align:center">Id</th>
                        <th width="26%" style="text-align:center">Created time (GMT +0800)</th>
                        <th width="7%" style="text-align:center">From</th>
                        <th width="11%" style="text-align:center">Tags</th>
                        <th width="20%" style="text-align:center">Place</th>
                        <th width="22%" style="text-align:center">Messages</th>      
                    </b></tr>
                </thead>


                <tbody id="tbody">

                </tbody>

            </table>
        </div>

        <div id="calendar" style="display:none; margin: 3em 0 1.5em 5em">
            &nbsp;<span class="glyphicon glyphicon-calendar"></span>&nbsp;Select Date:&nbsp;&nbsp;
            <label for="from">from</label>
            <input type="text" id="from" name="from">
            <label for="to">to</label>
            <input type="text" id="to" name="to">

            <button class="btn btn-default" type="submit" onclick="selectDate()">Go!</button>
        </div>

        <div id="maps-div" style="width: 1000px; height: 450px; margin: 2em 0 4em 5em; display:none">
        </div>

        <div id="route-div" style="display:none">
            <!--svg id="my-svg" height="5000" width="1280">
            </svg-->
            <ul id="myroute">
            </ul>

        </div>

    </div>

    <!-- ENDBLOCK: Your playground -->

    <!-- BLOCK: Your script playground -->
    <script id="my-script-playground">

                            // application id                           // Javascript Key
        Parse.initialize("yZpmiPeLmoZJxU65MP0N9DaahZmWlHtw7Tz7TxQh", "3lVzYbZerRWPatDPQA4RCnbK29AMhNdqRG245FdF");

        // initialization

        var ACCESS_TOKEN;
        var userid;
        var n=0;

        window.fbAsyncInit = function() {
            // init the FB JS SDK
            // FB.init({
            Parse.FacebookUtils.init({ // this line replaces FB.init({
                appId      : '231421070390192',                    // App ID from the app dashboard //checkins:231421070390192 // Lab:699947756683654
                cookie     : true,                                 // Allowed server-side to fetch fb auth cookie
                status     : true,                                 // Check Facebook Login status
                xfbml      : true,                                 // Look for social plugins on the page
                version    : 'v2.2'
            });

            // Additional initialization code such as adding Event Listeners goes here
            window.fbLoaded();
        };

        // Load the SDK asynchronously
        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            //js.src = "http://connect.facebook.net/en_US/all.js";
            // Debug version of Facebook JS SDK
            js.src = "http://connect.facebook.net/en_US/all/debug.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));


        $("#my-logout-message").html("Hi, please login with Facebook. (Recommended broswer: Google Chrome) ");

        window.fbLoaded = function(){

            (function() {
                var e = document.createElement('script'); e.async = true;
                e.src = document.location.protocol 
                    + '//connect.facebook.net/en_US/all.js';
                document.getElementById('fb-root').appendChild(e);
                console.log("all.js");
            }());

            FB.getLoginStatus(function(response) {

                // if the user has logged in
                if (response.status === 'connected') {
                    var loginControlDiv = document.getElementById("my-login-control");
                    loginControlDiv.style.display = "none";

                    var logoutControlDiv = document.getElementById("my-logout-control");
                    logoutControlDiv.style.display = "block";
                    var warningDiv = document.getElementById("warning-div");
                    warningDiv.style.display = "block";


                    Parse.FacebookUtils.logIn("user_tagged_places,user_photos,user_status,user_friends,user_about_me,user_birthday,read_stream", {

                        success: function(user) {
                            if (!user.existed()) {
                                alert("User signed up and logged in through Facebook!");
                            } else {
                                alert("User logged in through Facebook!");
                            }
                            FB.api('/me', function(response) { // 原本是info 然後response.name是undefined。 改成response後,response.name就是許惟琄了！
                                n=11111111;
                                console.log('n='+n);
                                console.log('Good to see you, ' + response.name + '.'); // response.name是許惟琄
                            });
                        },
                        error: function(user, error) {
                            alert("User cancelled the Facebook login or did not fully authorize.");
                        }
                    }); // end parse.fb.login


                    n=2;
                    console.log('n='+n);

                    // when user has been logged in, this block will be triggered.
                    //var msg = "Hi, You've logged in.";
                    //$("#my-login-message").html(msg);
                    console.log("Your login response:");
                    console.log(response);  // 這裡的authResponse裡有access_token!

                    // get access token
                    ACCESS_TOKEN=response.authResponse.accessToken;
                    console.log('ACCESS_TOKEN: '+ACCESS_TOKEN);

                    // get user id
                    userid=response.authResponse.userID;
                    console.log('userid: '+userid);


                    // fetch the profile
                    var ProfileDiv=document.getElementById("my-profile");
                    ProfileDiv.style.display="block";
                    fetch_my_profile();


                    // show photo wall
                    var PhotoWallDiv = document.getElementById("photo-wall");
                    PhotoWallDiv.style.display = "block";
                    photo_wall();

                    
                    // fetch user's data
                    var LoadingDiv = document.getElementById("loading-div");
                    LoadingDiv.style.display="block";
                    fbget_photos(userid, ACCESS_TOKEN);
                    

                
                } else if (response.status === 'not_authorized') {
                    //要求使用者登入，索取publish_actions權限

                    Parse.FacebookUtils.logIn("user_tagged_places,user_photos,user_status,user_friends,user_about_me,user_birthday,read_stream", {

                        success: function(user) {
                            if (!user.existed()) {
                                alert("User signed up and logged in through Facebook!");
                            } else {
                                alert("User logged in through Facebook!");
                            }

                            FB.api('/me', function(response) { // 原本是info 然後response.name是undefined。 改成response後,response.name就是許惟琄了！
                                n=333333333;
                                console.log('n='+n);
                                console.log('Good to see you, ' + response.name + '.'); // response.name是許惟琄
                            });
                            window.location.reload();
                        },
                        error: function(user, error) {
                            alert("User cancelled the Facebook login or did not fully authorize.");
                        }
                    }); // end parse.fb.login

                } else {
                    //同樣要求使用者登入
                    Parse.FacebookUtils.logIn("user_tagged_places,user_photos,user_status,user_friends,user_about_me,user_birthday,read_stream", {

                        success: function(user) {
                            if (!user.existed()) {
                                alert("User signed up and logged in through Facebook!");
                            } else {
                                alert("User logged in through Facebook!");
                            }
                            
                            FB.api('/me', function(response) { // 原本是info 然後response.name是undefined。 改成response後,response.name就是許惟琄了！
                                n=4444444444;
                                console.log('n='+n);
                                console.log('Good to see you, ' + response.name + '.'); // response.name是許惟琄
                            });
                            window.location.reload();
                        },
                        error: function(user, error) {
                            alert("User cancelled the Facebook login or did not fully authorize.");
                        }
                    }); // end parse.fb.login

                }   // end else

            });
            
            $("#brand").click(function(){
                location.reload();
            });

            // define the action when user clicked the login button.
            
            $("#my-login-button").click(function(){
                FB.getLoginStatus(function(response) {

                    // if the user has logged in
                    if (response.status === 'connected') {
                        var loginControlDiv = document.getElementById("my-login-control");
                        loginControlDiv.style.display = "none";

                        var logoutControlDiv = document.getElementById("my-logout-control");
                        logoutControlDiv.style.display = "block";
                        var warningDiv = document.getElementById("warning-div");
                        warningDiv.style.display = "block";

                        n=5;
                        console.log('n='+n);

                        // when user has been logged in, this block will be triggered.
                        var msg = "Hi, You've logged in.";
                        $("#my-login-message").html(msg);
                        console.log("Your login response:");
                        console.log(response);  // 這裡的authResponse裡有access_token!

                        // get access token
                        ACCESS_TOKEN=response.authResponse.accessToken;
                        console.log('ACCESS_TOKEN: '+ACCESS_TOKEN);

                        // get user id
                        userid=response.authResponse.userID;
                        console.log('userid: '+userid);

                        // fetch the profile
                        var ProfileDiv=document.getElementById("my-profile");
                        ProfileDiv.style.display="block";
                        fetch_my_profile();
                
                    } else if (response.status === 'not_authorized') {
                        //要求使用者登入，索取publish_actions權限
                        Parse.FacebookUtils.logIn("user_tagged_places,user_photos,user_status,user_friends,user_about_me,user_birthday,read_stream", {

                            success: function(user) {
                                if (!user.existed()) {
                                    alert("User signed up and logged in through Facebook!");
                                } else {
                                    alert("User logged in through Facebook!");
                                }
                            
                                FB.api('/me', function(response) { // 原本是info 然後response.name是undefined。 改成response後,response.name就是許惟琄了！
                                    n=666666666666;
                                    console.log('n='+n);
                                    console.log('Good to see you, ' + response.name + '.'); // response.name是許惟琄
                                });
                                window.location.reload();
                            },
                            error: function(user, error) {
                                alert("User cancelled the Facebook login or did not fully authorize.");
                            }
                        }); // end parse.fb.login
    
                    } else {
                        //同樣要求使用者登入
                        Parse.FacebookUtils.logIn("user_tagged_places,user_photos,user_status,user_friends,user_about_me,user_birthday,read_stream", {

                            success: function(user) {
                                if (!user.existed()) {
                                    alert("User signed up and logged in through Facebook!");
                                } else {
                                    alert("User logged in through Facebook!");
                                }
                            
                                FB.api('/me', function(response) { // 原本是info 然後response.name是undefined。 改成response後,response.name就是許惟琄了！
                                    n=777777777777;
                                    console.log('n='+n);
                                    console.log('Good to see you, ' + response.name + '.'); // response.name是許惟琄
                                });
                                window.location.reload();
                            },
                            error: function(user, error) {
                                alert("User cancelled the Facebook login or did not fully authorize.");
                            }
                        }); // end parse.fb.login
                        
                    }   // end else

                });     // end fb.getLoginStatus
            });     // end login btn click

            $("#my-logout-button").click(function(){
                console.log("click on my-logout-button");
                n=0;
                console.log('n='+n);    // 按了logout後，n=6

                FB.logout(function(response){
                    var logoutControlDiv = document.getElementById("my-login-control");
                    logoutControlDiv.style.display = "block";
                    var loginControlDiv = document.getElementById("my-logout-control");
                    loginControlDiv.style.display = "none";

                    n=0.5;
                    console.log('n='+n);

                    console.log("Your logout response:");
                    console.log(response);
                    alert('You are logging out. Bye!');
                });

                location.reload();  // refresh

            });

            $("#user-info").click(function(){
                console.log('Now you click the user button.....');

                var MapsDiv = document.getElementById("maps-div");
                MapsDiv.style.display = "none";
                var LocationDiv = document.getElementById("location-div");
                LocationDiv.style.display = "none";
                var RouteDiv = document.getElementById("route-div");
                RouteDiv.style.display = "none";
                var CalendarDiv = document.getElementById("calendar");
                CalendarDiv.style.display = "none";

                var MyProfileDiv = document.getElementById("my-profile");
                MyProfileDiv.style.display = "block";

                // show photo wall
                var PhotoWallDiv = document.getElementById("photo-wall");
                PhotoWallDiv.style.display = "block";
                photo_wall();

            });

            $("#from-locations-button").click(function(){
                console.log('Now you click the fetch button.....');

                var MyProfileDiv=document.getElementById("my-profile");
                MyProfileDiv.style.display="block";

                var LoadingDiv = document.getElementById("loading-div");
                LoadingDiv.style.display="block";
                var LocationDiv=document.getElementById("location-div");
                LocationDiv.style.display="none";
                var MapsDiv=document.getElementById("maps-div");
                MapsDiv.style.display="none";
                var RouteDiv=document.getElementById("route-div");
                RouteDiv.style.display="none";
                var PhotoWallDiv = document.getElementById("photo-wall");
                PhotoWallDiv.style.display = "none";
                var CalendarDiv = document.getElementById("calendar");
                CalendarDiv.style.display="none";

                setCookie("ACCESS_TOKEN", ACCESS_TOKEN);    

                console.log('userid: '+userid);             // correct
                console.log('ACCESS_TOKEN: '+ACCESS_TOKEN); // correct
                fbget_photos(userid, ACCESS_TOKEN);
                //fbget_feed(userid,ACCESS_TOKEN);
            });

            $("#demonstrate-as-table-button").click(function(){
                console.log('Now you click the demostrate button.....');

                var LocationDiv=document.getElementById("location-div");
                LocationDiv.style.display="block";

                var MyProfileDiv=document.getElementById("my-profile");
                MyProfileDiv.style.display="none";
                var MapsDiv=document.getElementById("maps-div");
                MapsDiv.style.display="none";
                var RouteDiv=document.getElementById("route-div");
                RouteDiv.style.display="none";
                var PhotoWallDiv = document.getElementById("photo-wall");
                PhotoWallDiv.style.display = "none";
                var CalendarDiv = document.getElementById("calendar");
                CalendarDiv.style.display="none";

                $("tbody").empty();

                demo_table();

            });

            $("#maps").click(function(){
                console.log('Now you click the Visualization button.....');

                var MyProfileDiv=document.getElementById("my-profile");
                MyProfileDiv.style.display="none";
                var LocationDiv=document.getElementById("location-div");
                LocationDiv.style.display="none";
                var RouteDiv=document.getElementById("route-div");
                RouteDiv.style.display="none";
                var PhotoWallDiv = document.getElementById("photo-wall");
                PhotoWallDiv.style.display = "none";


                // show calendar
                var Calendar = document.getElementById("calendar");
                Calendar.style.display="block";

                // show map
                var MapsDiv=document.getElementById("maps-div");
                MapsDiv.style.display="block";

                setCookie("ACCESS_TOKEN", ACCESS_TOKEN);    

                console.log('userid: '+userid);             // correct
                console.log('ACCESS_TOKEN: '+ACCESS_TOKEN); // correct
                //fbget(userid, ACCESS_TOKEN);
                demo_map(userid, ACCESS_TOKEN);

                $("#myroute").empty();
                route();

            });

            $("#draw-route").click(function(){
                console.log('Now you click the draw-route button.....');

                var MyProfileDiv=document.getElementById("my-profile");
                MyProfileDiv.style.display="none";
                var LocationDiv=document.getElementById("location-div");
                LocationDiv.style.display="none";
                var MapsDiv=document.getElementById("maps-div");
                MapsDiv.style.display="none";
                var LoadingDiv = document.getElementById("loading-div");
                LoadingDiv.style.display="none";
                var PhotoWallDiv = document.getElementById("photo-wall");
                PhotoWallDiv.style.display = "none";

                var RouteDiv=document.getElementById("route-div");
                RouteDiv.style.display="block";

                $("#myroute").empty();

                route();

            });

            function setCookie(cname,cvalue)
            {
                var d = new Date();
                d.setTime(d.getTime()+(60*60*1000));
                var expires = "expires="+d.toGMTString();
                document.cookie = cname+"="+cvalue+"; "+expires;
            }

            var fetch_my_profile = function () {

                FB.api('/me', function(response) {

                    $("#my-profile-name").html(response.name);
                    $("#my-profile-username").html(response.username);
                    $("#my-profile-gender").html(response.gender);
                    $("#my-profile-birthday").html(response.birthday);
                    $("#my-profile-facebook-id").html(response.id);


                    /*
                    var user = Parse.Object.extend("User");
                    user.set("fb_name",response.name);
                    user.set("fb_username",response.username);
                    user.set("fb_gender",response.gender);
                    user.set("fb_birthday",response.birthday);
                    user.set("fb_id",response.id)
                    */

                    $("#user-name").html(response.name);
                    alert('Hello ' + response.name + ' ^_^');
                });


                FB.api('/me/picture?width=160', function(response) {
                    var my_picture_url = response.data.url;
                    $("#my-profile-picture").attr('src', my_picture_url);
                });

            };

            var fetch_photos = function (){
                FB.api("/me/photos" , function (response) {
                    var photo_id = response.id;
                    $("#places-from-photos").html(photo_id);
                });
            };

        };
    </script>
    <!-- ENDBLOCK: Your script playground -->

    <script> 

        function photo_wall(){
            console.log("in photo_wall() ");


            $('#photo-wall ul').empty();

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(4);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.find({
                success: function(results) {
                    console.log("Successfully retrieved " + results.length + " results.");
                    console.log(results);
                    for (var i = 0; i < results.length; i++) { 

                        $('#photo-wall ul').append(
                            $('<li>').append(
                                $('<a>').attr('href','#').append(
                                    $('<img>').attr('src',results[i].attributes.pic_url))));


                    }   // end for

                },
                error: function(error) {
                    console.log("Error: " + error.code + " " + error.message);
                }
            }); // end query
        };  // end function photo_wall



        var N = 0;

        function fbget_photos(userid, token) {

            console.log("in fbget_photos()");


            var LoadingDiv = document.getElementById("loading-div");
            LoadingDiv.style.display = "block";

            var last_tags_length;
            var post_counter = 0;
            //var created_time;
            //console.log(userid);

            //FB.api("/v1.0/"+userid+"/photos?fields=id", function (response) {
            FB.api("/v2.0/"+userid+"/photos?fields=id", function (response) {
    
                if(response && !response.error) {      
                    var data = response;

                    //console.log('data.data.length: '+data.data.length);
                    console.log('in fbget_photos and the data is');
                    console.log(data);

                    
                    console.log('paging:');
                    console.log(data.paging.next);
                    var next_page = data.paging.next;


                    for(var i = 0; i < data.data.length; i++){

                        var post_id = data.data[i].id;
                
                        FB.api("/"+post_id, function (response) {
        
                            if(response && !response.error) {

                                ++N;
                                insertIntoDB(response,N);

                            }   // end if

                        }); // end FB.api
                
                    }   // end for

                    paging_photos(next_page,userid,token);

                } // end if(response && !response.error) 

        
                function insertIntoDB(data,N){

                    console.log("in insertIntoDB()");
                    console.log(data);

                    var Node = Parse.Object.extend("Node");
                    var query = new Parse.Query(Node);
                    query.equalTo("post_id", data.id);
                    console.log("querying-----------------post_id:"+data.id);


                    // check if data has already been existed in parse database.    
                    query.find().then( function(results) {
                        
                        console.log("Query successfully!!! results --> " + results.length + "                (0 --> no existed // 1 --> existed)");

                        // no existed data in DB, so insert new data into DB
                        if(results.length == 0 ){

                            var user = Parse.User.current();
                            var node = new Node();

                            node.set("user_id",user);
                            node.set("post_id",data.id);
                            node.set("from",data.from.name);
                            node.set("pic_url",data.source);

                            //console.log("created_time:"+data.created_time);
                            //console.log("updated_time:"+data.updated_time);


                            if(data.created_time != undefined){
                                node.set("created_time",data.created_time);
                            } else {
                                node.set("created_time",data.updated_time);
                            }


                            var post_tags = "";
                            if(data.tags != null){
                                post_tags_length = data.tags.data.length;
                                for(var j = 0; j < post_tags_length; j++){
                                    if(j == 0){
                                        post_tags += data.tags.data[j].name;
                                    } else {
                                        post_tags += ", ";
                                        post_tags += data.tags.data[j].name;
                                    }
                                }
                            }
                            node.set("tags",post_tags);


                            var post_message = data.message;
                            if(post_message == undefined){
                                post_message = data.name;
                            }
                            node.set("message",post_message);


                            var post_place_data = data.place;
                            if( post_place_data != undefined ){
                                node.set("place_name",data.place.name);
                                node.set("place_id",data.place.id);
                                node.set("longitude",data.place.location.longitude);
                                node.set("latitude",data.place.location.latitude);
                            }


                            return node.save();

                        } else {
                            console.log("this post_id has already existed in the database.");
                        }   // end if
                    }).then(function(node){

                        console.log('New object created with objectId: ' + node.id);

                        if( N % 20 == 0)
                            $('#photo-wall ul').empty();

                        if( N % 5 == 0){
                            $('#photo-wall ul').append(
                                $('<li>').append(
                                    $('<a>').attr('href','#').append(
                                        $('<img>').attr('src',node.attributes.pic_url))));
                        }

                    }, function(error) {        // query error
                        console("Error: " + error.code + " " + error.message);
                    }); // end query
                    
                };  // end function insertIntoDB



                function paging_photos(next_page,userid,token){

                    FB.api(next_page, function (response) {

                        if(response && !response.error) {      
                            var data = response;

                            console.log('data.data.length: '+data.data.length);
                            console.log('in fbget_photos paging and the data is');
                            console.log(data);
                            //console.dir(response);


                            console.log('paging:');
                            console.log(data.paging.next);
                            var next_page = data.paging.next;

                                
                                //var LoadingDiv = document.getElementById("loading-div");
                                //LoadingDiv.style.display="none";

                                //alert("Finished fetching your locations! :) ");

                            if(next_page != undefined){
                                for(var i = 0;i < data.data.length;i++){

                                    var post_id = data.data[i].id;
                                    //console.log("post_id"+post_id);
                    
                                    FB.api("/"+post_id, function (response) {
            
                                        if(response && !response.error) {

                                            ++N;
                                            insertIntoDB(response,N);

                                        }   // end if
                                    }); // end FB.api(post_id)
                    
                                }   // end for

                                paging_photos(next_page,userid,token);
                            }
                            else {
                                console.log("fbget_photos finish.");
                                console.log("start fbget_feed.");
                                fbget_feed(userid,token);
                            }

                        } // end if(response && !response.error)
                    }); // end FB.api(next_page) functuon

                }; // end function paging

            }); // end FB.api("/v1.0/me/locations") function
            
        }; // end function fbget


        function fbget_feed(userid, token) {

            console.log("in fbget_feed()");
  
            var last_tags_length;
            var post_counter = 0;
            //var created_time;
            console.log(userid);

            //FB.api("/me/photos?fields=id", function (response) {
            //FB.api("/v2.0/"+userid+"?fields=tagged_places", function (response) {
            FB.api("/v2.0/me/feed?fields=place", function (response) {
            //FB.api(userid, {fields: 'tagged_places'}, function(response) {
    
                if(response && !response.error) {      
                    var data = response;

                    //console.log('data.data.length: '+data.data.length);
                    console.log('in fbget_feed and the data is');
                    console.log(data);
                    //console.dir(response);

                    
                    console.log('paging:');
                    //console.log(data.paging.next);
                    var next_page = data.paging.next;
                    console.log('   next_page:');
                    console.log(next_page);



                    for(var i = 0;i < data.data.length;i++){

                        if(data.data[i].place != undefined){

                            var post_id = data.data[i].id;
                            //console.log("post_id"+post_id);
                
                            FB.api("/"+post_id, function (response) {
        
                                if(response && !response.error) {
                                    //console.log("in fbgetMMM");      
                                    //console.log(response);

                                    ++N;
                                    insertIntoDB(response,N);

                                }   // end if

                            }); // end FB.api
                        }
                    }   // end for

                    paging(next_page);

                } // end if(response && !response.error) 

        
                function insertIntoDB(data,N){

                    console.log("in insertIntoDB()");
                    console.log(data);

                    var Node = Parse.Object.extend("Node");
                    var query = new Parse.Query(Node);
                    query.equalTo("post_id", data.id);
                    console.log("querying-----------------post_id:"+data.id);


                    // check if data has already been existed in parse database.    
                    //query.find().then( function(results) {
                    query.find({
                        success: function(results) {
                            console.log("Query successfully!!! results --> " + results.length + "                (0 --> no existed // 1 --> existed)");
                            //console.log(results);
                            //console.log(data);

                            var created_time = data.created_time;
                            var same_date = created_time.substring(0,11);

                            var query_2 = new Parse.Query(Node);
                            query_2.equalTo("place_name", data.place.name);
                            //query_2.equalTo("created_time", created_time);  // string!
                            query_2.startsWith("created_time", same_date);  // filter same data

                            query_2.find().then( function(results) {

                                // no existed data in DB, so insert new data into DB
                                if(results.length == 0 ){

                                    var user = Parse.User.current();
                                    var node = new Node();

                                    node.set("user_id",user);
                                    node.set("post_id",data.id);
                                    node.set("from",data.from.name);

                                    if(data.picture != undefined){
                                        node.set("pic_url",data.picture);
                                    }

                                //console.log("created_time:"+data.created_time);
                                //console.log("updated_time:"+data.updated_time);


                                    if(data.created_time != undefined){
                                        node.set("created_time",data.created_time);
                                    } else {
                                        node.set("created_time",data.updated_time);
                                    }


                                    var post_tags = "";
                                    if(data.with_tags != null){
                                        post_tags_length = data.with_tags.data.length;
                                        for(var j = 0; j < post_tags_length; j++){
                                            //console.log(j+"---------"+data.tags.data[j].name);
                                            if(j == 0){
                                                post_tags += data.with_tags.data[j].name;
                                            } else {
                                                post_tags += ", ";
                                                post_tags += data.with_tags.data[j].name;
                                            }
                                            //console.log("............post_tags:"+post_tags);
                                        }
                                    }
                                    node.set("tags",post_tags);


                                    var post_message = data.message;
                                    if(post_message == undefined){
                                        post_message = data.name;
                                    }
                                    node.set("message",post_message);


                                    var post_place_data = data.place;
                                    if( post_place_data != undefined ){
                                        node.set("place_name",data.place.name);
                                        node.set("place_id",data.place.id);
                                        node.set("longitude",data.place.location.longitude);
                                        node.set("latitude",data.place.location.latitude);
                                    }

                                    return node.save();
                                
                                } else {
                                    console.log("this post_id has already existed in the database.");
                                }   // end if
                                
                            }).then(function(node){
                                console.log('New object created with objectId: ' + node.id);
                                //console.log(node);

                                if( N % 20 == 0)
                                    $('#photo-wall ul').empty();

                                if( N % 5 == 0){
                                    $('#photo-wall ul').append(
                                        $('<li>').append(
                                            $('<a>').attr('href','#').append(
                                                $('<img>').attr('src',node.attributes.pic_url))));
                                }

                            }, function(error) {        // query error
                                console.log("Error: " + error.code + " " + error.message);
                            }); // end query

                            
                            
                            },
                            error: function(error){
                                console.log("Error: " + error.code + " " + error.message);
                            }
                            

                        }); // end query.find()
                    
                    };  // end function insertIntoDB



//    }); // end function fbget

                function paging(next_page){
                    FB.api(next_page, function (response) {

                        if(response && !response.error) {      
                            var data = response;

                            console.log('data.data.length: '+data.data.length);
                            console.log('in fbget_feed paging and the data is');
                            console.log(data);
                            //console.dir(response);

                            if(data.data.length > 0){
                                console.log('paging:');
                                console.log(data.paging.next);
                                var next_page = data.paging.next;
                            } else {
                                console.log('data.data.length <= 0');

                                
                                setTimeout(function(){
                                    var LoadingDiv = document.getElementById("loading-div");
                                    LoadingDiv.style.display="none";
                                    alert('Finished fetching your locations! :) ');
                                    //window.location.reload();
                                },10000);

                            }


                            for(var i = 0;i < data.data.length;i++){

                                if(data.data[i].place != undefined){

                                    var post_id = data.data[i].id;
                                    //console.log("post_id"+post_id);
                
                                    FB.api("/"+post_id, function (response) {
        
                                        if(response && !response.error) {
                                            //console.log("in fbgetMMM");      
                                            //console.log(response);

                                            ++N;
                                            insertIntoDB(response,N);

                                        }   // end if

                                    }); // end FB.api
                                }
                
                            }   // end for

                            paging(next_page);

                        } // end if(response && !response.error)
                    }); // end FB.api(next_page) functuon

                }; // end function paging

            }); // end FB.api("/v1.0/me/locations") function
            
        }; // end function fbget


        function demo_table(){

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(1000);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.find({
                success: function(results) {
                    console.log("Successfully retrieved " + results.length + " scores.");
                    console.log(results);
                    for (var i = 0; i < results.length; i++) { 

                        var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                        var messages = results[i].attributes.message;
                        if(messages == undefined)
                            messages = '';

                        var place_name = results[i].attributes.place_name;
                        if(place_name == undefined)
                            place_name = '';

                        tbody.innerHTML += 
                            "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";
                    }   // end for

                },
                error: function(error) {
                    console.log("Error: " + error.code + " " + error.message);
                }
            }); // end query

        };  // end function demo_table

        function searchAll(){
            console.log("now search All!");


            var LocationDiv = document.getElementById("location-div");
            LocationDiv.style.display = "block";

            var MyProfileDiv = document.getElementById("my-profile");
            MyProfileDiv.style.display = "none";
            var MapsDiv = document.getElementById("maps-div");
            MapsDiv.style.display = "none";
            var RouteDiv = document.getElementById("route-div");
            RouteDiv.style.display = "none";
            var PhotoWallDiv = document.getElementById("photo-wall");
            PhotoWallDiv.style.display = "none";
            var CalendarDiv = document.getElementById("calendar");
            CalendarDiv.style.display = "none";


            $("tbody").empty();


            var search_text = document.getElementById("search_text").value;
            console.log("search_text:"+search_text);

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();
            var Node = Parse.Object.extend("Node");


            var query_1 = new Parse.Query(Node);
            query_1.contains("from",search_text);

            var query_2 = new Parse.Query(Node);
            query_2.contains("tags",search_text);

            var query_3 = new Parse.Query(Node);
            query_3.contains("place_name",search_text);

            var query_4 = new Parse.Query(Node);
            query_4.contains("message",search_text);

            var mainQuery = new Parse.Query(Node).limit(1000);
            mainQuery.equalTo("user_id", user);
            mainQuery = Parse.Query.or(query_1, query_2, query_3, query_4);
            mainQuery.descending("created_time");
            mainQuery.find().then(function(results) {

                console.log("Successfully retrieved " + results.length + " results of all.");
                console.log(results);


                if(results.length == 0){
                    var table = document.getElementById("table");
                    table.style.display = "none";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="block";
                }
                else {
                    var table = document.getElementById("table");
                    table.style.display = "block";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="none";
                }


                for (var i = 0; i < results.length; i++) {

                    var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                    var messages = results[i].attributes.message;
                    if(messages == undefined)
                        messages = '';

                    var place_name = results[i].attributes.place_name;
                    if(place_name == undefined)
                        place_name = '';

                    tbody.innerHTML += 
                        "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";


                }   // end for
            }); // end query.find().then

        };  // end function searchFrom



        function searchFrom(){
            console.log("now search From!");


            var LocationDiv = document.getElementById("location-div");
            LocationDiv.style.display = "block";

            var MyProfileDiv = document.getElementById("my-profile");
            MyProfileDiv.style.display = "none";
            var MapsDiv = document.getElementById("maps-div");
            MapsDiv.style.display = "none";
            var RouteDiv = document.getElementById("route-div");
            RouteDiv.style.display = "none";
            var PhotoWallDiv = document.getElementById("photo-wall");
            PhotoWallDiv.style.display = "none";
            var CalendarDiv = document.getElementById("calendar");
            CalendarDiv.style.display = "none";


            $("tbody").empty();


            var search_text = document.getElementById("search_text").value;
            console.log("search_text:"+search_text);

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(1000);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.contains("from",search_text);
            query.find().then(function(results) {

                console.log("Successfully retrieved " + results.length + " results of from.");
                console.log(results);


                if(results.length == 0){
                    var table = document.getElementById("table");
                    table.style.display = "none";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="block";
                }
                else {
                    var table = document.getElementById("table");
                    table.style.display = "block";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="none";
                }


                for (var i = 0; i < results.length; i++) {

                    var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                    var messages = results[i].attributes.message;
                    if(messages == undefined)
                        messages = '';

                    var place_name = results[i].attributes.place_name;
                    if(place_name == undefined)
                        place_name = '';

                    tbody.innerHTML += 
                        "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";


                }   // end for
            }); // end query.find().then

        };  // end function searchFrom


        function searchTags(){
            console.log("now search Tags!");


            var LocationDiv = document.getElementById("location-div");
            LocationDiv.style.display = "block";

            var MyProfileDiv = document.getElementById("my-profile");
            MyProfileDiv.style.display = "none";
            var MapsDiv = document.getElementById("maps-div");
            MapsDiv.style.display = "none";
            var RouteDiv = document.getElementById("route-div");
            RouteDiv.style.display = "none";
            var PhotoWallDiv = document.getElementById("photo-wall");
            PhotoWallDiv.style.display = "none";
            var CalendarDiv = document.getElementById("calendar");
            CalendarDiv.style.display = "none";


            $("tbody").empty();


            var search_text = document.getElementById("search_text").value;
            console.log("search_text:"+search_text);

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(1000);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.contains("tags",search_text);
            query.find().then(function(results) {

                console.log("Successfully retrieved " + results.length + " results of tags.");
                console.log(results);


                if(results.length == 0){
                    var table = document.getElementById("table");
                    table.style.display = "none";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="block";
                }
                else {
                    var table = document.getElementById("table");
                    table.style.display = "block";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="none";
                }


                for (var i = 0; i < results.length; i++) {

                    var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                    var messages = results[i].attributes.message;
                    if(messages == undefined)
                        messages = '';

                    var place_name = results[i].attributes.place_name;
                    if(place_name == undefined)
                        place_name = '';

                    tbody.innerHTML += 
                        "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";


                }   // end for
            }); // end query.find().then



        };  // end function searchTags


        function searchPlace(){
            console.log("now search Place Name!");


            var LocationDiv = document.getElementById("location-div");
            LocationDiv.style.display = "block";

            var MyProfileDiv = document.getElementById("my-profile");
            MyProfileDiv.style.display = "none";
            var MapsDiv = document.getElementById("maps-div");
            MapsDiv.style.display = "none";
            var RouteDiv = document.getElementById("route-div");
            RouteDiv.style.display = "none";
            var PhotoWallDiv = document.getElementById("photo-wall");
            PhotoWallDiv.style.display = "none";
            var CalendarDiv = document.getElementById("calendar");
            CalendarDiv.style.display = "none";


            $("tbody").empty();


            var search_text = document.getElementById("search_text").value;
            console.log("search_text:"+search_text);

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(1000);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.contains("place_name",search_text);
            query.find().then(function(results) {

                console.log("Successfully retrieved " + results.length + " results of place_name.");
                console.log(results);


                if(results.length == 0){
                    var table = document.getElementById("table");
                    table.style.display = "none";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="block";
                }
                else {
                    var table = document.getElementById("table");
                    table.style.display = "block";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="none";
                }


                for (var i = 0; i < results.length; i++) {

                    var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                    var messages = results[i].attributes.message;
                    if(messages == undefined)
                        messages = '';

                    var place_name = results[i].attributes.place_name;
                    if(place_name == undefined)
                        place_name = '';

                    tbody.innerHTML += 
                        "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";


                }   // end for
            }); // end query.find().then

        };  // end function searchPlace



        function searchMessage(){
            console.log("now search Messages!");


            var LocationDiv = document.getElementById("location-div");
            LocationDiv.style.display = "block";

            var MyProfileDiv = document.getElementById("my-profile");
            MyProfileDiv.style.display = "none";
            var MapsDiv = document.getElementById("maps-div");
            MapsDiv.style.display = "none";
            var RouteDiv = document.getElementById("route-div");
            RouteDiv.style.display = "none";
            var PhotoWallDiv = document.getElementById("photo-wall");
            PhotoWallDiv.style.display = "none";
            var CalendarDiv = document.getElementById("calendar");
            CalendarDiv.style.display = "none";


            $("tbody").empty();


            var search_text = document.getElementById("search_text").value;
            console.log("search_text:"+search_text);

            var tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            var user = Parse.User.current();

            var Node = Parse.Object.extend("Node");
            var query = new Parse.Query(Node).limit(1000);
            query.equalTo("user_id", user);
            query.descending("created_time");
            query.contains("message",search_text);
            query.find().then(function(results) {

                console.log("Successfully retrieved " + results.length + " results of messages.");
                console.log(results);


                if(results.length == 0){
                    var table = document.getElementById("table");
                    table.style.display = "none";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="block";
                }
                else {
                    var table = document.getElementById("table");
                    table.style.display = "block";
                    var no_results = document.getElementById("no_results");
                    no_results.style.display="none";
                }


                for (var i = 0; i < results.length; i++) {

                    var created_time = new Date(results[i].attributes.created_time).toLocaleString();

                    var messages = results[i].attributes.message;
                    if(messages == undefined)
                        messages = '';

                    var place_name = results[i].attributes.place_name;
                    if(place_name == undefined)
                        place_name = '';

                    tbody.innerHTML += 
                        "<tr id = tbody"+(i+1)+">"+
                            "<td style='text-align:center'>"+(i+1)+"</td>"+
                            "<td style='text-align:center'>"+results[i].attributes.post_id+"</td>"+   // id
                            "<td style='text-align:center'>"+created_time+"</td>"+   // created_time
                            "<td style='text-align:center'>"+results[i].attributes.from+"</td>"+   // from
                            "<td style='text-align:center'>"+results[i].attributes.tags+"</td>"+   // tags
                            "<td style='text-align:center'>"+place_name+"</td>"+   // place
                            "<td style='text-align:center'>"+messages+"</td>"+   // message
                        "</tr>";


                }   // end for
            }); // end query.find().then


        };  // end function searchPlace


</script>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript" language="javascript">

    function demo_map(userid, token) {

        var user = Parse.User.current();

        var Node = Parse.Object.extend("Node");
        var query = new Parse.Query(Node).limit(1000);
        query.equalTo("user_id", user);
        //query.exists("place_name");
        query.descending("created_time");
        query.find({
            success: function(results) {
                console.log("Successfully retrieved " + results.length + " scores.");
                console.log(results);

                initialize();

                //var route_array = [];

                for (var i = 0; i < results.length; i++) { 

                    var post_counter = 0;

                    //var objectId = results[i].id;

/*                        
                    var latitude = results[i].attributes.latitude;
                    var longitude = results[i].attributes.longitude;

                        route_array.push(new google.maps.LatLng(latitude,longitude));

                        var route = new google.maps.Polyline({
                            path: route_array,
                            geodesic: true,
                            strokeColor: '#F75D59',
                            strokeOpacity: 1.0,
                            strokeWeight: 4
                        });

                        route.setMap(map);
*/
                    addSite(map,results[i]);
/*
                    var query_every_node = new Parse.Query(Node);
                    query_every_node.get(objectId, {
                        success: function(node) {
                                //console.log("successful!!!  query_every_node:::");
                                //console.log(node);

                            addSite(map,node);

                            },
                        error: function(object, error) {
                            console.log("error");
                        }
                    }); // end query_every_node
*/

                }   // end for
            },
            error: function(error) {
                console.log("Error: " + error.code + " " + error.message);
            }
        });

    };  // end demo_map

    function initialize() {

        console.log("in initialize()");
        //console.log(data);

        map = new google.maps.Map(document.getElementById('maps-div'), {
            zoom: 12,
            center: new google.maps.LatLng(25.05,121.533), // 設定地圖中心點
            mapTypeId: google.maps.MapTypeId.TERRAIN // HYBRID,ROADMAP,SATELLITE,TERRAIN  
        });    

        google.maps.event.addDomListener(window, 'load', initialize);
    };  // end initialize


    var prev_infowindow = null;
    function addSite(map, node) {
        console.log('in addSite()');
        //console.log(node);

        var post_time = new Date(node.attributes.created_time).toLocaleString();

        var post_tags = node.attributes.tags;
        var post_from = node.attributes.from;

        var post_place = node.attributes.place_name;
        var post_longitude = node.attributes.longitude;
        var post_latitude = node.attributes.latitude;

        var post_message = node.attributes.message;
        var post_pic_url = node.attributes.pic_url;
        //console.log("post_pic_url:");
        //console.log(post_pic_url);



        var pt = new google.maps.LatLng(post_latitude,post_longitude);
        var marker = new google.maps.Marker({
            map: map,
            position : pt,
            animation: google.maps.Animation.DROP,
            /*icon: "http://png.findicons.com/files/icons/1665/sweetie_basepack/16/16_circle_red.png",*/
            title: post_place
        });
        google.maps.event.addListener(marker, 'click', toggleBounce);


        if(post_message == undefined){
            post_message = "";
        }

        if(post_pic_url == undefined){
             var contentString = 
                '<div id="content">'+
                '<div id="siteNotice">'+
                '</div>'+
                '<h2 id="firstHeading" class="firstHeading"><b>'+post_place+'</b></h2>'+   // place name
                '<div id="bodyContent">'+

                '<h4><b id="title">Date - </b>'+ post_time + '<br />' + // date
                '<b id="title">From- </b> '+ post_from +'<br />' + // from
                '<b id="title">Tags - </b> '+ post_tags +'<br /></h4>' + // tags

                '<h4>' + post_message + '<br /></h4>' + // message

                '</div>'+
                '</div>';
        } else {
            var contentString = 
                '<div id="content">'+
                '<div id="siteNotice">'+
                '</div>'+
                '<h2 id="firstHeading" class="firstHeading"><b>'+post_place+'</b></h2>'+   // place name
                '<img src="'+ post_pic_url +'" style="width:50%;height:50%;">'+     // photo
                '<div id="bodyContent">'+

                '<h4><b id="title">Date - </b>'+ post_time + '<br />' + // date
                '<b id="title">From- </b> '+ post_from +'<br />' + // from
                '<b id="title">Tags - </b> '+ post_tags +'<br /></h4>' + // tags

                '<h4>' + post_message + '<br /></h4>' + // message

                '</div>'+
                '</div>';

        }   // end if


        var infowindow = new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 300,
            maxHeight: 250
        });
 

        google.maps.event.addListener(marker, 'mouseover', function() {
            if (prev_infowindow != null) prev_infowindow.close();
            prev_infowindow = infowindow;
            infowindow.open(map, marker);
        }); 

        function toggleBounce() {

            if (marker.getAnimation() != null) {
                marker.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }     
        }           

    };   // end addSite

    function selectDate(){

        console.log("in selectDate()");

        var d_from = document.getElementById("from").value;
        console.log("d_from:"+d_from);
        var d_to = document.getElementById("to").value;
        console.log("d_to:"+d_to);

        var date_from = new Date(d_from.slice(6,10), d_from.slice(0,2)-1, d_from.slice(3,5) );
        var date_to = new Date(d_to.slice(6,10), d_to.slice(0,2)-1, d_to.slice(3,5) );
        console.log("date_from:"+date_from);
        console.log("date_to"+date_to);


        var user = Parse.User.current();

        var Node = Parse.Object.extend("Node");
        var query = new Parse.Query(Node).limit(1000);
        query.equalTo("user_id", user);
        query.exists("pic_url");
        query.descending("created_time");
        query.find({
            success: function(results) {
                console.log("Successfully retrieved " + results.length + " scores.");
                console.log(results);

                initialize();

                //var route_array = [];
                var object = [];

                for (var i = 0; i < results.length; i++) { 

                    var post_time = new Date(results[i].attributes.created_time);
                    //console.log(post_time.between(date_from, date_to));

                    if(post_time.between(date_from, date_to) == true){
                        addSite(map,results[i]);

                        object.push(results[i]);
                    }
                    
                }   // end for

                draw_route(object);

            },
            error: function(error) {
                console.log("Error: " + error.code + " " + error.message);
            }
        });

    };

</script>
<script type="text/javascript" language="javascript">
    function route(){
        console.log('in route()');

        //var my_svg = document.getElementById("my-svg");


        var user = Parse.User.current();

        var Node = Parse.Object.extend("Node");
        var query = new Parse.Query(Node).limit(1000);
        query.equalTo("user_id", user);
        query.exists("pic_url");
        query.descending("created_time");
        query.find().then( function(results) {

            console.log("Successfully retrieved " + results.length + " scores.");
            console.log(results);

            draw_route(results);


        }, function(error) {
            console.log("Error: " + error.code + " " + error.message);

        }); // end query.find



    };  // end function route()
        
    function draw_route(results){

        console.log("in draw_route()");
        console.log(results);

        var RouteDiv = document.getElementById("route-div");
        RouteDiv.style.display = "block";

        var myroute = document.getElementById("myroute");
        myroute.innerHTML = "";

        for(var i = 0; i < results.length; i++){

            var pic_url = results[i].attributes.pic_url;
            var place_name = results[i].attributes.place_name;
            var message = results[i].attributes.message;
            var post_tags = results[i].attributes.tags;


            //var post_time = new Date(results[i].attributes.created_time).toLocaleString();
            var post_time = "";
            post_time += new Date(results[i].attributes.created_time).getFullYear().toString() + "-";
            var month = new Date(results[i].attributes.created_time).getMonth() + 1 ;
            post_time += month.toString() + "-";
            post_time += new Date(results[i].attributes.created_time).getDate().toString();


            if(i % 2 == 0){  // left


                /*****  fit in photos mainly  *****/

                // X: place_name
                if(place_name == undefined){

                    // X: place_name, message
                    if (message == undefined){
                        myroute.innerHTML += '<li class="left"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><div class="down_cont"><h5><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                    // X: place_name    O: message
                    else {
                        myroute.innerHTML += '<li class="left"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><p>' + message + '</p><div class="down_cont"><h5><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                // O: place_name
                } else {

                    // O: place_name    X: message
                    if (message == undefined){
                        myroute.innerHTML += '<li class="left"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><div class="down_cont"><h5><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;' + place_name + '<br><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                    // O: place_name, message
                    else {
                        myroute.innerHTML += '<li class="left"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><p>' + message + '</p><div class="down_cont"><h5><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;' + place_name + '<br><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }
                }


            }   // end if left



            else {         // right


                /*****  fit in photos mainly  *****/

                // X: place_name
                if(place_name == undefined){

                    // X: place_name, message
                    if (message == undefined){
                        myroute.innerHTML += '<li class="right"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><div class="down_cont"><h5><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                    // X: place_name    O: message
                    else {
                        myroute.innerHTML += '<li class="right"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><p>' + message + '</p><div class="down_cont"><h5><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                // O: place_name
                } else {

                    // O: place_name    X: message
                    if (message == undefined){
                        myroute.innerHTML += '<li class="right"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><div class="down_cont"><h5><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;' + place_name + '<br><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                    // O: place_name, message
                    else {
                        myroute.innerHTML += '<li class="right"><img src="' + pic_url + '" /><h3>' + post_time + '</h3><p>' + message + '</p><div class="down_cont"><h5><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;' + place_name + '<br><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;' + post_tags + '</h5></div></li>';
                    }

                }


            }   // end if right


        }   // end for
    };  // end function draw_route()





/*
        var dates = [];
        
        var user = Parse.User.current();

        var Node = Parse.Object.extend("Node");
        var query = new Parse.Query(Node).limit(1000);
        query.equalTo("user_id", user);
        query.descending("created_time");
        query.find().then( function(results) {

            console.log("Successfully retrieved " + results.length + " scores.");
            console.log(results);

            for(var i=0; i<results.length; i++){
                //var post_time = new Date(results[i].attributes.created_time).toLocaleString();
                var date = results[i].attributes.created_time.substring(0,10);

                //console.log("date:"+date);

                dates.push(date);
            }

            console.log(dates);



            // draw diagram            
            my_svg.innerHTML += '<circle cx='+cx+' cy='+cy+' r='+r+' />';
            my_svg.innerHTML += '<text x='+cx+' y='+cy+50+'>2014/11/04</text>';
            for (var i = 0; i < results.length; i++) { 

                var j = i % 23;
                console.log("j:"+j);

                if(counter % 2 == 0){
                    if(j % 12 == 0){
                        ++counter;
                        my_svg.innerHTML += '<line x1='+(cx + a*(j-1))+' y1='+(cy + b*(counter-1) + r)+' x2='+(cx + a*(j-1)-35)+' y2='+(cy + b*counter)+' />';
                        my_svg.innerHTML += '<circle cx='+(cx + a*(j-1)-2*r)+' cy='+(cy + b*counter)+' r='+r+' />';
                        my_svg.innerHTML += '<text x='+(cx+ a*(j-1)-2*r)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                    } else {
                        console.log("draw odd lines.");
                        my_svg.innerHTML += '<line x1='+(cx + a*(j-1) + r)+' y1='+(cy + counter*b)+' x2='+(cx + a*j)+' y2='+(cy + counter*b)+' />';
                        my_svg.innerHTML += '<circle cx='+(cx + a*j)+' cy='+( cy+counter*b )+' r='+r+' />';
                        if(j % 11 == 0){
                            my_svg.innerHTML += '<text x='+(cx+ a*j+10)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                        } else {
                            my_svg.innerHTML += '<text x='+(cx+ a*j)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                        }
                    }
                } else {
                    if(j % 12 == 0){
                        ++counter;
                        my_svg.innerHTML += '<line x1='+(cx+35)+' y1='+(cy + b*(counter-1)+r)+' x2='+cx+' y2='+(cy + b*counter)+' />';
                        my_svg.innerHTML += '<circle cx='+cx+' cy='+(cy + b*counter)+' r='+r+' />';
                        my_svg.innerHTML += '<text x='+cx+' y='+(cy + counter*b+50)+'>2014/11/04</text>';

                    } else {
                        console.log("draw even lines.");
                        my_svg.innerHTML += '<line x1='+(cx + a*(23-j)-r)+' y1='+(cy + counter*b)+' x2='+(cx + a*(23-j)+5)+' y2='+(cy + counter*b)+' />';
                        my_svg.innerHTML += '<circle cx='+(cx + a*(23-j)-2*r)+' cy='+( cy+counter*b )+' r='+r+' />';
                        if(j % 11 == 0){
                            my_svg.innerHTML += '<text x='+(cx+40)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                        } else {
                            my_svg.innerHTML += '<text x='+(cx+ a*(23-j)-2*r)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                        }
                    }
                }
                    
            }   // end for
            

        }, function(error) {
            console.log("Error: " + error.code + " " + error.message);

        }); // end query.find

*/

/*
        //console.log(dates);

        my_svg.innerHTML += '<circle cx='+cx+' cy='+cy+' r='+r+' />';
        my_svg.innerHTML += '<text x=50 y=100>2014/11/04</text>';

        for(var i=1; i<306; i++){
            var j = i%23;
            if(counter % 2 == 0){
                if(j % 12 == 0){
                    ++counter;
                    my_svg.innerHTML += '<line x1='+(cx + a*(j-1))+' y1='+(cy + b*(counter-1) + r)+' x2='+(cx + a*(j-1)-35)+' y2='+(cy + b*counter)+' />';
                    my_svg.innerHTML += '<circle cx='+(cx + a*(j-1)-2*r)+' cy='+(cy + b*counter)+' r='+r+' />';
                    my_svg.innerHTML += '<text x='+(cx+ a*(j-1)-2*r)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                } else {
                    my_svg.innerHTML += '<line x1='+(cx + a*(j-1) + r)+' y1='+(cy + counter*b)+' x2='+(cx + a*j)+' y2='+(cy + counter*b)+' />';
                    my_svg.innerHTML += '<circle cx='+(cx + a*j)+' cy='+( cy+counter*b )+' r='+r+' />';
                    if(j % 11 == 0){
                        my_svg.innerHTML += '<text x='+(cx+ a*j+10)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                    } else {
                        my_svg.innerHTML += '<text x='+(cx+ a*j)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                    }
                }
            } else {
                if(j % 12 == 0){
                    ++counter;
                    my_svg.innerHTML += '<line x1='+(cx+35)+' y1='+(cy + b*(counter-1)+r)+' x2='+cx+' y2='+(cy + b*counter)+' />';
                    my_svg.innerHTML += '<circle cx='+cx+' cy='+(cy + b*counter)+' r='+r+' />';
                    my_svg.innerHTML += '<text x='+cx+' y='+(cy + counter*b+50)+'>2014/11/04</text>';

                } else {
                    my_svg.innerHTML += '<line x1='+(cx + a*(23-j)-r)+' y1='+(cy + counter*b)+' x2='+(cx + a*(23-j)+5)+' y2='+(cy + counter*b)+' />';
                    my_svg.innerHTML += '<circle cx='+(cx + a*(23-j)-2*r)+' cy='+( cy+counter*b )+' r='+r+' />';
                    if(j % 11 == 0){
                        my_svg.innerHTML += '<text x='+(cx+40)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                    } else {
                        my_svg.innerHTML += '<text x='+(cx+ a*(23-j)-2*r)+' y='+(cy+counter*b+50)+'>2014/11/04</text>';
                    }
                }
            }
        }   // end for
*/
/*  
        // original diagram
        my_svg.innerHTML += '<circle cx='+cx+' cy='+cy+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';
        my_svg.innerHTML += '<text x=20 y=100 fill="#777">2014/11/04</text>';
        //$("#my-svg").append("svg:text").attr("x","20").attr("y","100").attr("fill","#777").html("2014/11/04");
        for(var i=1; i<306; i++){
            var j = i%24;
            if(counter % 2 == 0){
                if(j % 12 == 0){
                    ++counter;
                    my_svg.innerHTML += '<line x1='+(cx + a*(j-1))+' y1='+(cy + b*(counter-1) + r)+' x2='+(cx + a*(j-1))+' y2='+(cy + b*counter)+' style="stroke:#777; stroke-width:8" />';
                    my_svg.innerHTML += '<circle cx='+(cx + a*(j-1))+' cy='+(cy + b*counter)+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';
                } else {
                    my_svg.innerHTML += '<line x1='+(cx + a*(j-1) + r)+' y1='+(cy + counter*b)+' x2='+(cx + a*j)+' y2='+(cy + counter*b)+' style="stroke:#777; stroke-width:8" />';
                    my_svg.innerHTML += '<circle cx='+(cx + a*j)+' cy='+( cy+counter*b )+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';

                }
            } else {
                if(j % 12 == 0){
                    ++counter;
                    my_svg.innerHTML += '<circle cx='+cx+' cy='+(cy + b*(counter-1))+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';
                    my_svg.innerHTML += '<line x1='+cx+' y1='+(cy + b*(counter-1) + r)+' x2='+cx+' y2='+(cy + b*counter)+' style="stroke:#777; stroke-width:8" />';
                    my_svg.innerHTML += '<circle cx='+cx+' cy='+(cy + b*counter)+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';
                } else {
                    my_svg.innerHTML += '<circle cx='+(cx + a*(23-j))+' cy='+( cy+counter*b )+' r='+r+' stroke="#777" stroke-width="2" fill="#e7e7e7" />';
                    my_svg.innerHTML += '<line x1='+(cx + a*(24-j) - r)+' y1='+(cy + counter*b)+' x2='+(cx + a*(23-j) + r)+' y2='+(cy + counter*b)+' style="stroke:#777; stroke-width:8" />';
                }
            }
        }   // end for
*/

    //};  // end route
</script>
</body>
</html>
